# RC 学习笔记
***

## PID--调参
- [闭环和PID控制，视频](https://www.bilibili.com/video/BV17x411d7XR)
- [RM控制实例讲解](https://www.bilibili.com/read/cv6515031/)
- [Matlab中国讲解的PID算法和误差修正](https://www.bilibili.com/video/BV19U4y1L7Uw/?spm_id_from=333.999.0.0)
- [PID算法实现](https://zhuanlan.zhihu.com/p/468741326)

## CAN bus
- [简介](https://blog.csdn.net/CSDN_Yoa/article/details/81384924)
- [CAN协议](https://www.kvaser.cn/about-can/can-protocol-tutorial/)
- [demo代码](https://blog.csdn.net/qq_33693310/article/details/116884820)

### CAN报文（协议层）
#### 数据帧
51 + （0~64）位 = （51~117）位  
![图一](/can-msg/can-msg-1.png)  
*标准CAN*

![图二](/can-msg/can-msg-2.png)  
*拓展CAN*

0. SOF - 起始，显性（0）表示报文开始
1. 仲裁字段ID  
    11位的标志符（拓展模式29位，并包含两个隐性位 SRR,IDE） + 一个支配数据帧的RTR位  
    **标识符注意事项：标识符可以是11位（CAN 2.0A）或29位（CAN 2.0B）。这不完全正确。**
    > 出于与某种老式CAN控制器兼容的原因，标识符不得把7个最高有效位都设置为1。所以，对于11位标识符，只剩下0到2031，29位标识符可以使用532676608个不同的值。注意，所有其它CAN控制器都接受“非法”标识符，所以现代CAN系统标识符2032到2047可以自由使用。

        - RTR 远程发送请求位，当需要从另一个节点请求信息时，此位为显性（逻辑0）。所有节点都能接收这个请求，但是帧标识符确定被指定的节点。响应数据帧同样被所有节点接收，可以被有兴趣的节点使用。  
        - SRR 隐性位，在扩展格式中SRR是固定数值，SRR位永远置1，保证了标准数据帧的优先级高于扩展数据帧。  
        - IDE 隐性位，标识符扩展位为显性（0）时表示这是一个标准CAN格式，为隐形（1）表示这是扩展CAN格式，保证了标准遥控帧优先级高于扩展数据帧。  
1. 数据字段  
    0~8字节(64位)
2. CRC字段  
    16位，包含一个基于报文大部分数据计算得到的15位校验和校验和用于错误检测(15位）+ 定界符（1位）。
3. ACK字段  
    2位，包含应答位和应答界定符。发送节点的报文帧中，ACK两位是隐性位（1)，当接收器正确地接收到有效的报文，接收器会在应答位期间向发送节点发送一个显性位(0)，表示应答。如果接收器发现这帧数据有错误，则不向发送节点发送ACK应答，发送节点会稍后重传这帧数据。
4. EOF字段  
    7位帧结束标志位，全部为隐性位。如果这7位出现显性位，则会引起填充错误。
5. IFS  
    7位帧间隔标志位，CAN控制器将接收到的帧正确的放入消息缓冲区是需要一定时间的，帧间隔可以提供这个时间。

#### 远程帧（遥控帧)
![图片三](can-msg/can-msg-3.png)  
远程帧与数据帧十分相似，但是有两个重要的区别：  
- 它被显式标记为远程帧（仲裁字段中的RTR位为隐性）
- 它没有数据字段
> 远程帧的预期目的是征求传输相应的数据帧。例如，如果节点A传输一个仲裁字段设置为234的远程帧，那么节点B（如果已经正确初始化）可能通过一个仲裁字段也设置为234的数据帧进行响应。
> 关于远程帧的一个注意事项：数据长度代码必须设置成预期响应报文的长度。否则仲裁将不起作用。

#### 错误帧
错误帧包含一个错误标志(Error flag)。这个错误标志是6位长的相同值（因此违背位填充规则）和一个错误定界符（8个隐性位）。错误定界符(Error delimiter)提供一些空间，以便总线上其它节点在检测到第一个错误标志时可以发送它们的错误标志。

#### 过载帧
不常用。在格式上，与错误帧相似，并且由会变得重荷的节点传送。据资料，会生成过载帧的唯一一种控制器是现在已经过时的82526。  

### CAN 的物理层
*注意，一些总线收发器不允许低于特定的比特率。*  
#### ISO11898-2
最常见的类型由CAN标准ISO11898-2部分定义的，它是双线平衡信令方案。有时也称为“高速CAN”。
- 最大总线速度: 按照标准，CAN总线的最大速度是1 Mbps。然而，一些CAN控制器能够处理比1Mbps更快的速度，可以在特殊应用场合中使用。
- 最大线缆长度：如果速度为1Mbps，可以使用的最大线缆长度大约为40米（130英尺）。这是因为仲裁方案要求信号的峰值可以到达最远的节点并且在位采样之前再次返回。换言之，线缆长度受光速限制。
> 其它的最大线缆长度是（这些是近似值):
> 100米（330英尺），比特率为500kbps
> 200米（650英尺），比特率为250kbps
> 500米（1600英尺），比特率为125kbps
> 6千米（20000英尺），比特率为10kbps

#### ISO11898-3 
同一个ISO标准的另一部分（ISO 11898-3）为低总线速度定义了另一种双线平衡信令方案。它具有容错能力，所以即使一条总线线缆断开或对地短路或连接到备用电池，信号都可以继续发出。有时也称为“低速CAN”。
- 最大总线速度: 低速CAN最快可以达到125 kbps。 
  
#### 总端端接
> ISO 11898 CAN总线必须进行端接。 通过在总线各端点使用120欧姆的电阻达到这个要求。端接可以达到两个目的：
> 1. 消除总线终端处的信号反射。
> 2. 确保总线获得正确的直流电电平。  

> 不管速度快慢，ISO 11898 CAN总线始终都必须进行端接。我将重复这一点：不管速度快慢，ISO 11898 CAN总线始终都必须进行端接。对于实验性工作，一个端接器可能就已足够。如果没有连接任何端接器，但是您的CAN总线仍然能够正常工作，那么您只是比较幸运而已。
> **注意，其它物理层（例如“低速CAN”、单线缆CAN和其它物理层）不一定需要进行端接。但是您的常用高速ISO 11898 CAN总线总是需要至少一个端接器。**

参考：[Using termination to ensure recessive bit transmission](https://www.kvaser.cn/en/using-termination-ensure-recessive-bit-transmission/)


## RoboMaster-A
- [大疆官网](https://www.robomaster.com/zh-CN/robo/overview?site=brandsite&from=nav)

## M3508减速直流电机
- [大疆官网，数据，demo](https://www.robomaster.com/zh-CN/products/components/general/M3508)  
- [简介](https://zhuanlan.zhihu.com/p/73376976)

## C620无刷电机调速器
- [官网，与M3508配套使用](https://store.dji.com/cn/product/rm-c620-brushless-dc-motor-speed-controller?from=robomaster_online)